# Ресерч - "Клиент серверная архитектура"

source: Habr, MDN Docs, YouTube

Общая схема:
1. Браузер обращается к DNS серверу и находит реальный адрес сервера.
2. Браузер посылает HTTP запрос к серверу, запрашивая его отправить копию сайта для клиента. Это сообщение и все остальные данные, передаваемые между клиентом и сервером, передаются по интернет-соединению с использованием протокола TCP/IP.
3. Если сервер одобряет запрос клиента, сервер отправляет клиенту статус "200 ОК", а затем начинает отправку файлов сайта в браузер в виде небольших порций, называемых пакетными данными.
4. Браузер собирает маленькие куски в полноценный сайт и показывает его вам.

## DNS
Первый шаг навигации к странице - это поиск места, откуда нужно запрашивать данные. Если вы переходите на https://example.com, браузер грузит HTML-код страницы с IP-адреса 93.184.216.34. 

Ваш браузер запрашивает DNS запись (соответствие домена к определенному IP-адресу) у доменного сервера. Доменное имя преобразуется в айпи адрес.
![IP](https://github.com/wwwaitwhattt/onboarding/blob/4-sprint/4-sprint/research/Screenshot_1.png)

Если пользователь уже обращался к ресурсу, то айпи адрес скорее всего уже сохранен в кеше браузера. (например: www.google.com есть в кеше -> домен преобразуется в айпи -> устанавливается соединение с сервером)

В противном случае: 
1. Браузер обращается в систему DNS серверов.
	DNS RESOLVER  - ищет по доменным записям IP-адрес с нужным доменным именем (www.google.com).
	1) Сначала обращается в корневой днс сервер. Он смотрит на домен первого уровня (.com) -> сообщает резолверу, что нужно обратиться к серверу, который обслуживает доменную зону .com
	2) Резолвер обращается к TOP LEVEL DOMAIN SERVER (сервер который обслуживает .com, смотрит на домен второго уровня). Сервер находит запись с адресом доменного сервера, который содержит запись с google.com. Сообщает резолверу, что нужно обратиться к этому серверу
	3) Резолвер обращается к серверу, содержащему доменную запись с google.com. Этот сервер сообщает айпи адрес.
Также, скорее всего у провайдера будут закешированы все частоиспользуемые ресурсы на собственных DNS серверах, чтобы каждый раз не проходить через цепочку выше.

## Web-сервер

После успешного получения IP-адреса устанавливается TCP-соединение с web-сервером и запрашиваются ресурсы.
#### TCP-handshake (тройное рукопожатие)

Для установления стабильного соединения с сервером используется протокол TCP (Transmission Control Protocol), который гарантирует, что данные будут переданы корректно и в верной последовательности.

**Установка TCP соединения:**
- SYN (synchronize) — Клиент отправляет на сервер специальный пакет SYN, уведомляя о намерении установить соединение и передавая начальный порядковый номер для передачи данных.
    
- SYN-ACK (synchronize-acknowledgment) — Сервер, получив пакет SYN, отправляет ответный пакет SYN-ACK. Этот пакет подтверждает получение запроса и также содержит свой начальный номер для синхронизации.
    
-  ACK (acknowledgment) — Клиент отправляет пакет ACK для подтверждения получения пакета SYN-ACK. После этого соединение считается установленным, и данные могут передаваться.

![IP](https://github.com/wwwaitwhattt/onboarding/blob/4-sprint/4-sprint/research/Screenshot_2.png)

По умолчанию: по протоколу HTTPS(шифрует передаваемые данные с помощью SSL/TLS) - 443 порт, по HTTP - 80.

Чтобы защитить данные пользователей от перехвата или подделки, браузеры и серверы используют протоколы шифрования — такие как SSL (Secure Sockets Layer) и его более современную версию TLS (Transport Layer Security).
Браузер и сервер проходят через процесс, известный как TLS-handshake. В ходе этого процесса стороны обмениваются сертификатами, ключами и устанавливают параметры шифрования. Это позволяет создать зашифрованный канал, по которому будут передаваться данные.
Веб-сервер принимает запросы и перенаправляет их в нужное место -> application server.

## Application-сервер

Сервер приложений **обрабатывает данные и использует бизнес-логику для предоставления правильной информации**. Затем запрос передается обратно на веб-сервер, который передает его пользователю. Их может быть большое количество. 

Здесь мы получаем данные для отображения страницы.
Формат запроса:
- Метод запроса. Метод указывает серверу, что именно требуется от него. В данном случае нужен GET (бывают GET, POST, PUT, DELETE, PATCH и др.).
    
- Заголовки. Заголовки запроса передают дополнительную информацию о браузере, предпочтениях пользователя и параметрах подключения, например, User-Agent, Accept-Language, Cookies.
Когда браузеру нужно загрузить страницу, он отправляет GET-запрос на сервер по указанному URL.

Сервер обрабатывает запрос. Собирается финальный http-ответ браузеру (html/json/etc. + status code + заголовки)
![IP](https://github.com/wwwaitwhattt/onboarding/blob/4-sprint/4-sprint/research/HTTP_Status_Codes.png)

После этого полученные данные с сервер рендерятся в браузере, преобразуются в финальную страницу.

### Дополнительно
В большинстве современных браузеров существует ограничение на количество параллельных HTTP-соединений к одному домену. Обычно это 6 одновременных соединений. Это ограничение влияет на скорость загрузки веб-страниц, так как браузер не может одновременно загружать все ресурсы (изображения, скрипты, стили) с одного домена, если их больше, чем количество разрешенных соединений.
- **HTTP/1.1:**
    Согласно протоколу HTTP/1.1, один пользовательский клиент не должен поддерживать более двух подключений к одному серверу или прокси.

- **HTTP/2 и HTTP/3:**
	HTTP/2 и HTTP/3 поддерживают мультиплексирование, что позволяет загружать несколько ресурсов по одному соединению, снижая зависимость от ограничений на количество соединений, но в целом, ограничения всё равно существуют, хотя и не такие строгие, как в HTTP/1.1
